В прошивке используется специально сформированный пакет ffmpeg-imx, который включает в себя помимо ffmpeg ещё и поддержку ffserver для тестовых задач.
В пакет включены конфигурационные файлы и скрипты запуска для системы инициализации procd, которая используется в openwrt.
Для настройки нужно использовать кофнигурационные файлы:
 - /etc/config/ffmpeg
 - /etc/config/ffserver
 
#### /etc/config/ffmpeg
Для настройки доступны опции:
| Опция |Описание  |
|--|--|
| in_device |Системное устройство захвата, обычно, /dev/video0.|
|framerate|Количество кадров в секунду, фреймрейт. Ввиду ограниченности производительности, лучше оставить значение 5.|
|resolution|Разрешение видео, ввиду ограниченности производительности, лучше оставить 780x480.|
|vcodec|Кодек исходящего видео.|
|b_v|Скорость исходящего видео-потока.|
|override_ffserver|Если ffmpeg используется с локальным ffserver, этот ключ желательно установить в '1', чтобы ffmpeg мог переопределять конфигурацию ffserver.|
|out_format|Указывает формат/протокол исходящего потока. Ключь '-f' для ffmpeg. Обычно, принимает значение 'ffm' или 'rtp'|
|remote|Адрес сервера назначения для трансляции, на этот адрес быдет отсылаться поток.|
|enabled|Ключ, включающий автозапуск ffmpeg при включении устройства.|

На текущий момент, конфигурация оптимизирована, и изменять стоит только параметр *remote*

#### /etc/config/ffserver
Для настройки доступны опции:
| Опция |Описание  |
|--|--|
|enabled|Ключ, включающий автозапуск ffserver при включении устройства.|
|config| Путь к конфигурационному файлу ffserver, большинство опций в конфигурационном файле будут игнорироваться, если ffmpeg запущен с *override_ffserver*|

<br>
<br>

## Пример RTSP сервера на основе VLC.
Для пробного запуска стриминга выполните следующие шаги:
1. Запустите на сервере:
$ vlc -vvv -I dummy rtp://0.0.0.0:3333 --sout '#rtp{dst=0.0.0.0,port=3334,sdp=rtsp://0.0.0.0:8080/test.sdp}'
Если vlc не установлен, то:
$ sudo apt-get install vlc
2. На плате imx6ull измените параметры override_ffserver (отключить, установить в "0"), remote (адрес удалённого сервера и порт на котором vlc слушает входящие подключения) и out_format (протокол rtp), чтоб конфигурационный файл выглядел следующим образом:

|config|ffmpeg|ffmpeg|
|--|--|--|
|  |option in_device| '/dev/video0'|
|  |option framerate| '5'|
|  |option resolution| '720x480'|
|  |option vcodec| 'mpeg2video'|
|  |option b_v| '192k'|
|  |option override_ffserver|'0'|
|  |option out_format|'rtp'|
|  |option remote|'rtp://192.168.0.103:3333'|
|  |option enabled|'1'|
После этого перезапустите ffmpeg на imx6ull командой
>/etc/init.d/ffmpeg restart

4. Запустите воспроизведение, подключившись к серверу:
$ vlc rtsp://127.0.0.1:8077/test.sdp
Здесь 127.0.0.1 - адрес rtsp-сервера, запущенного на первом шаге. Т.е. подразумевается, что воспроизведение вы запускаете на той же машине, на которой запущен сервер
